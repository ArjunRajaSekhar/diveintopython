
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>3.5. UserDict: a wrapper class</title><link rel="stylesheet" href="/css/diveintopython.css" type="text/css" /><link rev="made" href="josh@servercobra.com" /><meta name="generator" content="DocBook XSL Stylesheets V" /><meta name="keywords" content="Python, язык Python, язык программирования Python, Dive Into Python, В глубь языка Python, учебник, объектно-ориентированный, программирование, документация, книга, free, свободный, бесплатный" /><meta name="description" content="a free Python book for experienced programmers" /><link rel="home" href="http://ru.diveintopython.net/" title="В глубь языка Python" /><link rel="up" href="http://ru.diveintopython.net/" title="Глава 3. Средства объектно-ориентированного программирования" /><link rel="previous" href="http://ru.diveintopython.net/" title="3.4. Создание экземпляров классов" /><link rel="next" href="http://ru.diveintopython.net/" title="3.6. Special class methods" /><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body>
<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<table id="Header" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td id="breadcrumb" colspan="5" align="left"><a href="http://ru.diveintopython.net/index.html">&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/toc.html">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html">&#1057;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;</a>&nbsp;&gt;&nbsp;<b>UserDict: a wrapper class</b></td><td id="navigation" align="right">&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_instantiation.html" title="Пред.: “Создание экземпляров классов”">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_specialmethods.html" title="След.: “Special class methods”">&gt;&gt;</a></td></tr><tr><td><img src="http://ru.diveintopython.net/images/logo.png" alt="diveinto.python.ru" /></td><td colspan="2"><span id="logo">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</span><br /><span id="tagline">&#1044;&#1083;&#1103; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1089;&#1090;&#1086;&#1074;</span></td><td colspan="3" align="right"></td></tr></table><div class="section"><a name="fileinfo.userdict"></a><div class="titlepage"><div><h2 class="title"><a name="fileinfo.userdict"></a>3.5. <tt>UserDict</tt>: a wrapper class</h2></div></div><div class="abstract"><p>As you've seen, <tt>FileInfo</tt> is a class that acts like a dictionary.  To explore this further, let's look at the <tt>UserDict</tt> class in the <tt>UserDict</tt> module, which is the ancestor of our <tt>FileInfo</tt> class.  This is nothing special; the class is written in Python and stored in a <tt>.py</tt> file, just like our code.  In particular, it's stored in the <tt>lib</tt> directory in your Python installation.</p></div><a name="tip.locate"></a><table class="tip" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/tip.png" alt="Подсказка" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">In the Python IDE on Windows, you can quickly open any module in your library path with
File-&gt;Locate... (<b>Ctrl-L</b>).</td></tr></table><p>In Python, you can not subclass built-in datatypes like strings, lists, and dictionaries.  To compensate for this, Python comes with wrapper classes that mimic the behavior of these built-in datatypes: <tt>UserString</tt>, <tt>UserList</tt>, and <tt>UserDict</tt>.  Using a combination of normal and special methods, the <tt>UserDict</tt> class does an excellent imitation of a dictionary, but it's just a class like any other, so you can subclass it to provide custom dictionary-like classes like <tt>FileInfo</tt>.</p><div class="example"><p><a name="fileinfo.userdict.init.example"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.11. Defining the <tt>UserDict</tt> class</b></p><pre class="programlisting"><span class="pykeyword">
class</span> UserDict:                                <a name="fileinfo.userdict.1.1"></a><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
    <span class="pykeyword">def</span><span class="pyclass"> __init__</span>(self, dict=None):             <a name="fileinfo.userdict.1.2"></a><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" />
        self.data = {}                         <a name="fileinfo.userdict.1.3"></a><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" />
        <span class="pykeyword">if</span> dict <span class="pykeyword">is</span> <span class="pykeyword">not</span> None: self.update(dict) <a name="fileinfo.userdict.1.4"></a><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" />
</pre><div class="calloutlist"><a name="d0e3469"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.1.1"><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">Note that <tt>UserDict</tt> is a base class, not inherited from any other class.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.1.2"><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">This is the <tt>__init__</tt> method that we <a href="http://ru.diveintopython.net/fileinfo_class.html#fileinfo.class.example" title="Пример 3.6. Определение класса FileInfo">overrode in the <tt>FileInfo</tt> class</a>.  Note that the argument list in this ancestor class is different than the descendant.  That's okay; each subclass can have its own set of arguments, as long as it calls the ancestor with the correct arguments.  Here the ancestor class has a way to define initial values (by passing a dictionary in the <tt>dict</tt> argument) which our <tt>FileInfo</tt> does not take advantage of.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.1.3"><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">Python supports data attributes (called &#8220;instance variables&#8221; in Java and Powerbuilder, &#8220;member variables&#8221; in C++), which is data held by a specific instance of a class.  In this case, each instance of <tt>UserDict</tt> will have a data attribute <tt>data</tt>.  To reference this attribute from code outside the class, you would qualify it with the instance name, <tt><i>instance</i>.data</tt>, in the same way that you qualify a function with its module name.  To reference a data attribute from within the class, we use <tt>self</tt> as the qualifier.  By convention, all data attributes are initialized to reasonable values in the <tt>__init__</tt> method.  However, this is not required, since data attributes, like local variables, <a href="http://ru.diveintopython.net/odbchelper_vardef.html" title="1.10. Определение переменных">spring into existence</a> when they are first assigned a value.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.1.4"><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">This is a syntax you may not have seen before (I haven't used it in the examples in this book).  This is an <tt>if</tt> statement, but instead of having an indented block starting on the next line, there is just a single statement on the same line, after the colon.  This is perfectly legal syntax, and is just a shortcut when you have only one statement in a block.  (It's like specifying a single statement without braces in C++.)  You can use this syntax, or you can have indented code on subsequent lines, but you can't do both for the same block.</td></tr></table></div></div><a name="compare.overloading"></a><table class="note" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/note.png" alt="Замечание" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">Java and Powerbuilder support function overloading by argument list, <i>i.e.</i> one class can have multiple methods with the same name but a different number of arguments, or arguments of different types.  Other languages (most notably PL/SQL) even support function overloading by argument name; <i>i.e.</i> one class can have multiple methods with the same name and the same number of arguments of the same type but different argument names.  Python supports neither of these; it has no form of function overloading whatsoever.  An <tt>__init__</tt> method is an <tt>__init__</tt> method is an <tt>__init__</tt> method, regardless of its arguments.  There can be only one <tt>__init__</tt> method per class, and if a descendant class has an <tt>__init__</tt> method, it always overrides the ancestor <tt>__init__</tt> method, even if the descendant defines it with a different argument list.</td></tr></table><a name="note.dataattributes"></a><table class="note" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/note.png" alt="Замечание" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">Always assign an initial value to all of an instance's data attributes in the <tt>__init__</tt> method.  It will save you hours of debugging later.</td></tr></table><div class="example"><p><a name="fileinfo.userdict.normalmethods"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.12. <tt>UserDict</tt> normal methods</b></p><pre class="programlisting">
    <span class="pykeyword">def</span><span class="pyclass"> clear</span>(self): self.data.clear()          <a name="fileinfo.userdict.2.1"></a><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
    <span class="pykeyword">def</span><span class="pyclass"> copy</span>(self):                             <a name="fileinfo.userdict.2.2"></a><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" />
        <span class="pykeyword">if</span> self.__class__ <span class="pykeyword">is</span> UserDict:          <a name="fileinfo.userdict.2.3"></a><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" />
            <span class="pykeyword">return</span> UserDict(self.data)         
        <span class="pykeyword">import</span> copy                             <a name="fileinfo.userdict.2.4"></a><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" />
        <span class="pykeyword">return</span> copy.copy(self)                 
    <span class="pykeyword">def</span><span class="pyclass"> keys</span>(self): <span class="pykeyword">return</span> self.data.keys()     <a name="fileinfo.userdict.2.5"></a><img src="http://ru.diveintopython.net/images/callouts/5.png" alt="5" border="0" width="12" height="12" />
    <span class="pykeyword">def</span><span class="pyclass"> items</span>(self): <span class="pykeyword">return</span> self.data.items()  
    <span class="pykeyword">def</span><span class="pyclass"> values</span>(self): <span class="pykeyword">return</span> self.data.values()
</pre><div class="calloutlist"><a name="d0e3535"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.2.1"><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>clear</tt> is a normal class method; it is publicly available to be called by anyone at any time.  Note that <tt>clear</tt>, like all class methods, has <tt>self</tt> as its first argument.  (Remember, you <a href="http://ru.diveintopython.net/fileinfo_class.html#tip.whenself">don't include <tt>self</tt></a> when you call the method; it's something that Python adds for you.)  Also note the basic technique of this wrapper class: store a real dictionary (<tt>data</tt>) as a data attribute, define all the methods that a real dictionary has, and have each class method redirect to the corresponding method on the real dictionary.  (In case you'd forgotten, a dictionary's <tt>clear</tt> method <a href="http://ru.diveintopython.net/odbchelper_dict.html#odbchelper.dict.del" title="Пример 1.12. Удаление записей из словарей">deletes all of its keys</a> and their associated values.)</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.2.2"><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">The <tt>copy</tt> method of a real dictionary returns a new dictionary that is an exact duplicate of the original (all the same key-value pairs).  But <tt>UserDict</tt> can't simply redirect to <tt>self.data.copy</tt>, because that method returns a real dictionary, and what we want is to return a new instance that is the same class as <tt>self</tt>.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.2.3"><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">We use the <tt>__class__</tt> attribute to see if <tt>self</tt> is a <tt>UserDict</tt>; if so, we're golden, because we know how to copy a <tt>UserDict</tt>: just create a new <tt>UserDict</tt> and give it the real dictionary that we've squirreled away in <tt>self.data</tt>.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.2.4"><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">If <tt>self.__class__</tt> is not <tt>UserDict</tt>, then <tt>self</tt> must be some subclass of <tt>UserDict</tt> (like maybe <tt>FileInfo</tt>), in which case life gets trickier.  <tt>UserDict</tt> doesn't know how to make an exact copy of one of its descendants; there could, for instance, be other data attributes defined in the subclass, so we would have to iterate through them and make sure to copy all of them.  Luckily, Python comes with a module to do exactly this, and it's called <tt>copy</tt>.  I won't go into the details here (though it's a wicked cool module, if you're ever inclined to dive into it on your own).  Suffice to say that <tt>copy</tt> can copy arbitrary Python objects, and that's how we're using it here.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_userdict.html#fileinfo.userdict.2.5"><img src="http://ru.diveintopython.net/images/callouts/5.png" alt="5" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">The rest of the methods are straightforward, redirecting the calls to the built-in methods on <tt>self.data</tt>.</td></tr></table></div></div><div class="furtherreading"><p><b>Further reading</b></p><ul><li><a href="http://ru.diveintopython.net/doc/current/lib/"><i>Python Library Reference</i></a> documents the <a href="http://ru.diveintopython.net/doc/current/lib/module-UserDict.html"><tt>UserDict</tt> module</a> and the <a href="http://ru.diveintopython.net/doc/current/lib/module-copy.html"><tt>copy</tt> module</a>.</li></ul></div></div><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td width="35%" align="left"><br /><a href="http://ru.diveintopython.net/fileinfo_instantiation.html"><span class="NavigationArrow">&lt;&lt;</span>&nbsp;&#1057;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077; &#1101;&#1082;&#1079;&#1077;&#1084;&#1087;&#1083;&#1103;&#1088;&#1086;&#1074; &#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1074;</a></td><td width="30%" align="center"><br />&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html#fileinfo.divein" title="3.1. В глубь">1</a> <a href="http://ru.diveintopython.net/fileinfo_fromimport.html" title="3.2. Импортирование модулей инструкцией from module import">2</a> <a href="http://ru.diveintopython.net/fileinfo_class.html" title="3.3. Определение классов">3</a> <a href="http://ru.diveintopython.net/fileinfo_instantiation.html" title="3.4. Создание экземпляров классов">4</a> <b>5</b> <a href="http://ru.diveintopython.net/fileinfo_specialmethods.html" title="3.6. Special class methods">6</a> <a href="http://ru.diveintopython.net/fileinfo_morespecial.html" title="3.7. Advanced special class methods">7</a> <a href="http://ru.diveintopython.net/fileinfo_classattributes.html" title="3.8. Class attributes">8</a> <a href="http://ru.diveintopython.net/fileinfo_private.html" title="3.9. Private functions">9</a> <a href="http://ru.diveintopython.net/fileinfo_exception.html" title="3.10. Handling exceptions">10</a> <a href="http://ru.diveintopython.net/fileinfo_files.html" title="3.11. File objects">11</a> <a href="http://ru.diveintopython.net/fileinfo_for.html" title="3.12. for loops">12</a> <a href="http://ru.diveintopython.net/fileinfo_modules.html" title="3.13. More on modules">13</a> <a href="http://ru.diveintopython.net/fileinfo_os.html" title="3.14. The os module">14</a> <a href="http://ru.diveintopython.net/fileinfo_alltogether.html" title="3.15. Putting it all together">15</a> <a href="http://ru.diveintopython.net/fileinfo_summary.html" title="3.16. Summary">16</a>&nbsp;</td><td width="35%" align="right"><br /><a href="http://ru.diveintopython.net/fileinfo_specialmethods.html">Special class methods&nbsp;<span class="NavigationArrow">&gt;&gt;</span></a></td></tr><tr><td colspan="3"><br /></td></tr></table><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td align="left"><p class="copyright">Copyright &copy; 2000, 2001, 2002 <a href="mailto:josh@servercobra.com">&#1052;&#1072;&#1088;&#1082; &#1055;&#1080;&#1083;&#1075;&#1088;&#1080;&#1084;</a></p><p class="copyright">Copyright &copy; 2001, 2002, 2003 &#1055;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;, <a href="mailto:josh@servercobra.com">&#1044;&#1077;&#1085;&#1080;&#1089; &#1054;&#1090;&#1082;&#1080;&#1076;&#1072;&#1095;</a></p></td><td align="left">&nbsp;</td></tr></table></body></html>
