
<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chapter 5. Objects and Object-Orientation</title>
        <link rev="made" href="josh@servercobra.com" />
        <meta name="generator" content="convert_to_jinja2.py" />
        <meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free" />
        <meta name="description" content="Python from novice to pro" />
        <link rel="home" href="http://www.diveintopython.net/" title="Dive Into Python" />
        
        <link rel="up" href="../toc/index.html" title=" Dive Into Python" />
        
        
        
        <link rel="next" href="importing_modules.html" title=" 5.2.Importing Modules Using from module import" />
        
         <link rel="stylesheet" href="../css/normalize.css">
         <link rel="stylesheet" href="../css/foundation.css">
         <link rel="stylesheet" href="../css/diveintopython.css" type="text/css" />


         <script src="../js/modernizr.js"></script>
    </head>
    <body>
        <div class="row">
            <div class="small-12 columns" id="Header">
                <div class="row">
                    <div class="small-11 columns">
                        
                        <td align="left" colspan="5" id="breadcrumb" valign="top">You are here: <a href="../index.html">Home</a>&#160;&gt;&#160;<a href="../toc/index.html">Dive Into Python</a>&#160;&gt;&#160;<span class="thispage">Objects and Object-Orientation</span></td>
                        
                    </div>
                    <div class="small-1 columns">
                        
                        <td align="right" id="navigation" valign="top">&#160;&#160;&#160;<a href="../power_of_introspection/summary.html" title="Prev: &#8220;Summary&#8221;">&lt;&lt;</a>&#160;&#160;&#160;<a href="importing_modules.html" title="Next: &#8220;Importing Modules Using from module import&#8221;">&gt;&gt;</a></td>
                        
                    </div>
                </div>


                <div id="logocontainer">
                    <h1 id="logo"><a href="http://www.diveintopython.net/index.html" accesskey="1">Dive Into Python</a></h1>
                    <p id="tagline">Python from novice to pro</p>
                    <a href="http://www.amazon.com/gp/product/B001GIOFN8/ref=as_li_tf_tl?ie=UTF8&tag=diveintopython-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=B001GIOFN8"><img src="../images/amazon-buy-button.gif"></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <div class="titlepage">
<div>
<div>
<h2 class="title"><a name="fileinfo"></a>Chapter&#160;5.&#160;Objects and Object-Orientation
                  </h2>
</div>
</div>
<div></div>
</div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <div class="toc">
<ul>
<li><span class="section"><a href="index.html#fileinfo.divein">5.1. Diving In</a></span></li>
<li><span class="section"><a href="importing_modules.html">5.2. Importing Modules Using from module import</a></span></li>
<li><span class="section"><a href="defining_classes.html">5.3. Defining Classes</a></span><ul>
<li><span class="section"><a href="defining_classes.html#d0e11720">5.3.1. Initializing and Coding Classes</a></span></li>
<li><span class="section"><a href="defining_classes.html#d0e11896">5.3.2. Knowing When to Use self and __init__</a></span></li>
</ul>
</li>
<li><span class="section"><a href="instantiating_classes.html">5.4. Instantiating Classes</a></span><ul>
<li><span class="section"><a href="instantiating_classes.html#d0e12165">5.4.1. Garbage Collection</a></span></li>
</ul>
</li>
<li><span class="section"><a href="userdict.html">5.5. Exploring UserDict: A Wrapper Class</a></span></li>
<li><span class="section"><a href="special_class_methods.html">5.6. Special Class Methods</a></span><ul>
<li><span class="section"><a href="special_class_methods.html#d0e12822">5.6.1. Getting and Setting Items</a></span></li>
</ul>
</li>
<li><span class="section"><a href="special_class_methods2.html">5.7. Advanced Special Class Methods</a></span></li>
<li><span class="section"><a href="class_attributes.html">5.8. Introducing Class Attributes</a></span></li>
<li><span class="section"><a href="private_functions.html">5.9. Private Functions</a></span></li>
<li><span class="section"><a href="summary.html">5.10. Summary</a></span></li>
</ul>
</div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <div class="abstract">
<p>This chapter, and pretty much every chapter after this, deals with object-oriented <span class="application">Python</span> programming.
            </p>
</div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="fileinfo.divein"></a>5.1.&#160;Diving In
                     </h2>
</div>
</div>
<div></div>
</div>
<div class="abstract">
<p>Here is a complete, working <span class="application">Python</span> program.  Read the <a href="../getting_to_know_python/documenting_functions.html" title="2.3.&#160;Documenting Functions"><tt class="literal">doc string</tt>s</a> of the module, the classes, and the functions to get an overview of what this program does and how it works.  As usual, don't
                  worry about the stuff you don't understand; that's what the rest of the chapter is for.
               </p>
</div>
<div class="example"><a name="d0e11177"></a><h3 class="title">Example&#160;5.1.&#160;<tt class="filename">fileinfo.py</tt></h3>
<p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
               </p><pre class="programlisting">
<span class="pystring">"""Framework for getting filetype-specific metadata.

Instantiate appropriate class with filename.  Returned object acts like a
dictionary, with key-value pairs for each piece of metadata.
    import fileinfo
    info = fileinfo.MP3FileInfo("/music/ap/mahadeva.mp3")
    print "\\n".join(["%s=%s" % (k, v) for k, v in info.items()])

Or use listDirectory function to get info on all files in a directory.
    for info in fileinfo.listDirectory("/music/ap/", [".mp3"]):
        ...

Framework can be extended by adding classes for particular file types, e.g.
HTMLFileInfo, MPGFileInfo, DOCFileInfo.  Each class is completely responsible for
parsing its files appropriately; see MP3FileInfo for example.
"""</span>
<span class="pykeyword">import</span> os
<span class="pykeyword">import</span> sys
<span class="pykeyword">from</span> UserDict <span class="pykeyword">import</span> UserDict

<span class="pykeyword">def</span><span class="pyclass"> stripnulls</span>(data):
    <span class="pystring">"strip whitespace and nulls"</span>
    <span class="pykeyword">return</span> data.replace(<span class="pystring">"\00"</span>, <span class="pystring">""</span>).strip()

<span class="pykeyword">class</span><span class="pyclass"> FileInfo</span>(UserDict):
    <span class="pystring">"store file metadata"</span>
    <span class="pykeyword">def</span><span class="pyclass"> __init__</span>(self, filename=None):
        UserDict.__init__(self)
        self[<span class="pystring">"name"</span>] = filename

<span class="pykeyword">class</span><span class="pyclass"> MP3FileInfo</span>(FileInfo):
    <span class="pystring">"store ID3v1.0 MP3 tags"</span>
    tagDataMap = {<span class="pystring">"title"</span>   : (  3,  33, stripnulls),
                  <span class="pystring">"artist"</span>  : ( 33,  63, stripnulls),
                  <span class="pystring">"album"</span>   : ( 63,  93, stripnulls),
                  <span class="pystring">"year"</span>    : ( 93,  97, stripnulls),
                  <span class="pystring">"comment"</span> : ( 97, 126, stripnulls),
                  <span class="pystring">"genre"</span>   : (127, 128, ord)}

    <span class="pykeyword">def</span><span class="pyclass"> __parse</span>(self, filename):
        <span class="pystring">"parse ID3v1.0 tags from MP3 file"</span>
        self.clear()
        <span class="pykeyword">try</span>:                               
            fsock = open(filename, <span class="pystring">"rb"</span>, 0)
            <span class="pykeyword">try</span>:                           
                fsock.seek(-128, 2)        
                tagdata = fsock.read(128)  
            <span class="pykeyword">finally</span>:                       
                fsock.close()              
            <span class="pykeyword">if</span> tagdata[:3] == <span class="pystring">"TAG"</span>:
                <span class="pykeyword">for</span> tag, (start, end, parseFunc) <span class="pykeyword">in</span> self.tagDataMap.items():
                    self[tag] = parseFunc(tagdata[start:end])               
        <span class="pykeyword">except</span> IOError:                    
            <span class="pykeyword">pass</span>                           

    <span class="pykeyword">def</span><span class="pyclass"> __setitem__</span>(self, key, item):
        <span class="pykeyword">if</span> key == <span class="pystring">"name"</span> <span class="pykeyword">and</span> item:
            self.__parse(item)
        FileInfo.__setitem__(self, key, item)

<span class="pykeyword">def</span><span class="pyclass"> listDirectory</span>(directory, fileExtList):                                        
    <span class="pystring">"get list of file info objects for files of particular extensions"</span>
    fileList = [os.path.normcase(f)
                <span class="pykeyword">for</span> f <span class="pykeyword">in</span> os.listdir(directory)]           
    fileList = [os.path.join(directory, f) 
               <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList
                <span class="pykeyword">if</span> os.path.splitext(f)[1] <span class="pykeyword">in</span> fileExtList] 
    <span class="pykeyword">def</span><span class="pyclass"> getFileInfoClass</span>(filename, module=sys.modules[FileInfo.__module__]):      
        <span class="pystring">"get file info class from filename extension"</span>                             
        subclass = <span class="pystring">"%sFileInfo"</span> % os.path.splitext(filename)[1].upper()[1:]       
        <span class="pykeyword">return</span> hasattr(module, subclass) <span class="pykeyword">and</span> getattr(module, subclass) <span class="pykeyword">or</span> FileInfo
    <span class="pykeyword">return</span> [getFileInfoClass(f)(f) <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList]                             

<span class="pykeyword">if</span> __name__ == <span class="pystring">"__main__"</span>:
    <span class="pykeyword">for</span> info <span class="pykeyword">in</span> listDirectory(<span class="pystring">"/music/_singles/"</span>, [<span class="pystring">".mp3"</span>]): <a name="fileinfo_divein.1.1"></a><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12">
        <span class="pykeyword">print</span> <span class="pystring">"\n"</span>.join([<span class="pystring">"%s=%s"</span> % (k, v) <span class="pykeyword">for</span> k, v <span class="pykeyword">in</span> info.items()])
        print</img></pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo_divein.1.1"><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"/></a>
</td>
<td align="left" valign="top">This program's output depends on the files on your hard drive.  To get meaningful output, you'll need to change the directory
                           path to point to a directory of MP3 files on your own machine.
                        </td>
</tr>
</table>
</div>
</div>
<div class="informalexample">
<p>This is the output I got on my machine.  Your output will be different, unless, by some startling coincidence, you share my
                  exact taste in music.
               </p><pre class="screen"><span class="computeroutput">album=
artist=Ghost in the Machine
title=A Time Long Forgotten (Concept
genre=31
name=/music/_singles/a_time_long_forgotten_con.mp3
year=1999
comment=http://mp3.com/ghostmachine

album=Rave Mix
artist=***DJ MARY-JANE***
title=HELLRAISER****Trance from Hell
genre=31
name=/music/_singles/hellraiser.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Rave Mix
artist=***DJ MARY-JANE***
title=KAIRO****THE BEST GOA
genre=31
name=/music/_singles/kairo.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Journeys
artist=Masters of Balance
title=Long Way Home
genre=31
name=/music/_singles/long_way_home1.mp3
year=2000
comment=http://mp3.com/MastersofBalan

album=
artist=The Cynic Project
title=Sidewinder
genre=18
name=/music/_singles/sidewinder.mp3
year=2000
comment=http://mp3.com/cynicproject

album=Digitosis@128k
artist=VXpanded
title=Spinning
genre=255
name=/music/_singles/spinning.mp3
year=2000
comment=http://mp3.com/artists/95/vxp</span></pre></div>
</div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <table border="0" cellpadding="0" cellspacing="0" class="Footer" summary="" width="100%">
<tr>
<td align="left" width="35%"><br><a class="NavigationArrow" href="../power_of_introspection/summary.html">&lt;&lt;&#160;Summary</a></br></td>
<td align="center" width="30%"><br>&#160;<span class="divider">|</span>&#160;<span class="thispage">1</span> <span class="divider">|</span> <a href="importing_modules.html" title="5.2.&#160;Importing Modules Using from module import">2</a> <span class="divider">|</span> <a href="defining_classes.html" title="5.3.&#160;Defining Classes">3</a> <span class="divider">|</span> <a href="instantiating_classes.html" title="5.4.&#160;Instantiating Classes">4</a> <span class="divider">|</span> <a href="userdict.html" title="5.5.&#160;Exploring UserDict: A Wrapper Class">5</a> <span class="divider">|</span> <a href="special_class_methods.html" title="5.6.&#160;Special Class Methods">6</a> <span class="divider">|</span> <a href="special_class_methods2.html" title="5.7.&#160;Advanced Special Class Methods">7</a> <span class="divider">|</span> <a href="class_attributes.html" title="5.8.&#160;Introducing Class Attributes">8</a> <span class="divider">|</span> <a href="private_functions.html" title="5.9.&#160;Private Functions">9</a> <span class="divider">|</span> <a href="summary.html" title="5.10.&#160;Summary">10</a>&#160;<span class="divider">|</span>&#160;
            </br></td>
<td align="right" width="35%"><br><a class="NavigationArrow" href="importing_modules.html">Importing Modules Using from module import&#160;&gt;&gt;</a></br></td>
</tr>
<tr>
<td colspan="3"><br/></td>
</tr>
</table>
        <!-- Footer -->
<div class="Footer">
    <p><a href="https://github.com/pcsforeducation/diveintopython/issues?sort=created&state=open">Report issues<img style="margin-left:10px" height="40" src="../images/logo_github.png"></a></p>
    <p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003, 2004 <a href="mailto:josh@servercobra.com">Mark Pilgrim</a>. Maintained by Josh Gachnang.</p>
</div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-1879314568120827";
/* DiveIntoPython */
google_ad_slot = "8002881514";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<!-- End Footer -->
            </div>
        </div>
        <!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- End Google Analytics -->
        <script src="../js/jquery.js"></script>
        <script src="../js/foundation.min.js"></script>
        <script>
          $(document).foundation();
        </script>
    </body>
</html>