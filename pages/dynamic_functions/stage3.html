
<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>17.4.Â plural.py, stage 3</title>
        <link rev="made" href="josh@servercobra.com" />
        <meta name="generator" content="convert_to_jinja2.py" />
        <meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free" />
        <meta name="description" content="Python from novice to pro" />
        <link rel="home" href="http://www.diveintopython.net/" title="Dive Into Python" />
        
        <link rel="up" href="index.html" title=" Chapter17.Dynamic functions" />
        
        
        
        <link rel="next" href="stage4.html" title=" 17.5.plural.py, stage 4" />
        
         <link rel="stylesheet" href="../css/normalize.css">
         <link rel="stylesheet" href="../css/foundation.css">
         <link rel="stylesheet" href="../css/diveintopython.css" type="text/css" />


         <script src="../js/modernizr.js"></script>
    </head>
    <body>
        <div class="row">
            <div class="small-12 columns" id="Header">
                <div class="row">
                    <div class="small-11 columns">
                        
                        <td align="left" colspan="5" id="breadcrumb" valign="top">You are here: <a href="../index.html">Home</a>&#160;&gt;&#160;<a href="../toc/index.html">Dive Into Python</a>&#160;&gt;&#160;<a href="index.html">Dynamic functions</a>&#160;&gt;&#160;<span class="thispage">plural.py, stage 3</span></td>
                        
                    </div>
                    <div class="small-1 columns">
                        
                        <td align="right" id="navigation" valign="top">&#160;&#160;&#160;<a href="stage2.html" title="Prev: &#8220;plural.py, stage 2&#8221;">&lt;&lt;</a>&#160;&#160;&#160;<a href="stage4.html" title="Next: &#8220;plural.py, stage 4&#8221;">&gt;&gt;</a></td>
                        
                    </div>
                </div>


                <div id="logocontainer">
                    <h1 id="logo"><a href="http://www.diveintopython.net/index.html" accesskey="1">Dive Into Python</a></h1>
                    <p id="tagline">Python from novice to pro</p>
                    <a href="http://www.amazon.com/gp/product/B001GIOFN8/ref=as_li_tf_tl?ie=UTF8&tag=diveintopython-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=B001GIOFN8"><img src="../images/amazon-buy-button.gif"></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="plural.stage3"></a>17.4.&#160;<tt class="filename">plural.py</tt>, stage 3
                  </h2>
</div>
</div>
<div></div>
</div>
<div class="abstract">
<p>Defining separate named functions for each match and apply rule isn't really necessary.  You never call them directly; you
               define them in the <tt class="varname">rules</tt> list and call them through there.  Let's streamline the rules definition by anonymizing those functions.
            </p>
</div>
<div class="example"><a name="d0e37775"></a><h3 class="title">Example&#160;17.8.&#160;<tt class="filename">plural3.py</tt></h3><pre class="programlisting"><span class="pykeyword">
import</span> re

rules = \
  (
    (
     <span class="pykeyword">lambda</span> word: re.search(<span class="pystring">'[sxz]$'</span>, word),
     <span class="pykeyword">lambda</span> word: re.sub(<span class="pystring">'$'</span>, <span class="pystring">'es'</span>, word)
    ),
    (
     <span class="pykeyword">lambda</span> word: re.search(<span class="pystring">'[^aeioudgkprt]h$'</span>, word),
     <span class="pykeyword">lambda</span> word: re.sub(<span class="pystring">'$'</span>, <span class="pystring">'es'</span>, word)
    ),
    (
     <span class="pykeyword">lambda</span> word: re.search(<span class="pystring">'[^aeiou]y$'</span>, word),
     <span class="pykeyword">lambda</span> word: re.sub(<span class="pystring">'y$'</span>, <span class="pystring">'ies'</span>, word)
    ),
    (
     <span class="pykeyword">lambda</span> word: re.search(<span class="pystring">'$'</span>, word),
     <span class="pykeyword">lambda</span> word: re.sub(<span class="pystring">'$'</span>, <span class="pystring">'s'</span>, word)
    )
   )                                           <a name="plural.stage3.1.1"></a><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12">

<span class="pykeyword">def</span><span class="pyclass"> plural</span>(noun):                             
    <span class="pykeyword">for</span> matchesRule, applyRule <span class="pykeyword">in</span> rules:       <a name="plural.stage3.1.2"></a><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12">
        <span class="pykeyword">if</span> matchesRule(noun):                 
            <span class="pykeyword">return</span> applyRule(noun)            
</img></img></pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="12"><a href="#plural.stage3.1.1"><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"/></a>
</td>
<td align="left" valign="top">This is the same set of rules as you defined in stage 2.  The only difference is that instead of defining named functions
                        like <tt class="function">match_sxz</tt> and <tt class="function">apply_sxz</tt>, you have &#8220;<span class="quote">inlined</span>&#8221; those function definitions directly into the <tt class="varname">rules</tt> list itself, using <a href="../power_of_introspection/lambda_functions.html" title="4.7.&#160;Using lambda Functions">lambda functions</a>.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#plural.stage3.1.2"><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12"/></a>
</td>
<td align="left" valign="top">Note that the <tt class="function">plural</tt> function hasn't changed at all.  It iterates through a set of rule functions, checks the first rule, and if it returns a
                        true value, calls the second rule and returns the value.  Same as above, word for word.  The only difference is that the rule
                        functions were defined inline, anonymously, using lambda functions.  But the <tt class="function">plural</tt> function doesn't care how they were defined; it just gets a list of rules and blindly works through them.
                     </td>
</tr>
</table>
</div>
</div>
<p>Now to add a new rule, all you need to do is define the functions directly in the <tt class="varname">rules</tt> list itself: one match rule, and one apply rule.  But defining the rule functions inline like this makes it very clear that
            you have some unnecessary duplication here.  You have four pairs of functions, and they all follow the same pattern.  The
            match function is a single call to <tt class="function">re.search</tt>, and the apply function is a single call to <tt class="function">re.sub</tt>.  Let's factor out these similarities.
         </p>
</div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        <table border="0" cellpadding="0" cellspacing="0" class="Footer" summary="" width="100%">
<tr>
<td align="left" width="35%"><br><a class="NavigationArrow" href="stage2.html">&lt;&lt;&#160;plural.py, stage 2</a></br></td>
<td align="center" width="30%"><br>&#160;<span class="divider">|</span>&#160;<a href="index.html#plural.divein" title="17.1.&#160;Diving in">1</a> <span class="divider">|</span> <a href="stage1.html" title="17.2.&#160;plural.py, stage 1">2</a> <span class="divider">|</span> <a href="stage2.html" title="17.3.&#160;plural.py, stage 2">3</a> <span class="divider">|</span> <span class="thispage">4</span> <span class="divider">|</span> <a href="stage4.html" title="17.5.&#160;plural.py, stage 4">5</a> <span class="divider">|</span> <a href="stage5.html" title="17.6.&#160;plural.py, stage 5">6</a> <span class="divider">|</span> <a href="stage6.html" title="17.7.&#160;plural.py, stage 6">7</a> <span class="divider">|</span> <a href="summary.html" title="17.8.&#160;Summary">8</a>&#160;<span class="divider">|</span>&#160;
            </br></td>
<td align="right" width="35%"><br><a class="NavigationArrow" href="stage4.html">plural.py, stage 4&#160;&gt;&gt;</a></br></td>
</tr>
<tr>
<td colspan="3"><br/></td>
</tr>
</table>
        <!-- Footer -->
<div class="Footer">
    <p><a href="https://github.com/pcsforeducation/diveintopython/issues?sort=created&state=open">Report issues<img style="margin-left:10px" height="40" src="../images/logo_github.png"></a></p>
    <p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003, 2004 <a href="mailto:josh@servercobra.com">Mark Pilgrim</a>. Maintained by Josh Gachnang.</p>
</div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-1879314568120827";
/* DiveIntoPython */
google_ad_slot = "8002881514";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<!-- End Footer -->
            </div>
        </div>
        <!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- End Google Analytics -->
        <script src="../js/jquery.js"></script>
        <script src="../js/foundation.min.js"></script>
        <script>
          $(document).foundation();
        </script>
    </body>
</html>