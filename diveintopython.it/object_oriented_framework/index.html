
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Capitolo&nbsp;4.&nbsp;Una struttura orientata agli oggetti</title>
<link rel="stylesheet" href="/css/diveintopython.css" type="text/css" />
<link rev="made" href="josh@servercobra.com" />
<meta name="generator" content="DocBook XSL Stylesheets V1.52.2" />
<meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free" />
<meta name="description" content="Python from novice to pro" />
<link rel="home" href="http://it.diveintopython.net/" title="Dive Into Python" />
<link rel="up" href="http://it.diveintopython.net/toc/index.html" title="Dive Into Python" />
<link rel="previous" href="http://it.diveintopython.net/power_of_introspection/summary.html" title="3.9.&nbsp;Sommario" />
<link rel="next" href="http://it.diveintopython.net/object_oriented_framework/importing_modules.html" title="4.2.&nbsp;Importare i moduli usando from module import" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head>
<body>
<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<table id="Header" width="100%" border="0" cellpadding="0" cellspacing="0" summary="">
<tr>
<td id="breadcrumb" colspan="5" align="left" valign="top">You are here: <a href="http://it.diveintopython.net/index.html">Partenza</a>&nbsp;&gt;&nbsp;<a href="http://it.diveintopython.net/toc/index.html">Dive Into Python</a>&nbsp;&gt;&nbsp;<span class="thispage">Una struttura orientata agli oggetti</span></td>
<td id="navigation" align="right" valign="top">&nbsp;&nbsp;&nbsp;<a href="http://it.diveintopython.net/power_of_introspection/summary.html" title="Indietro: “Sommario”">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;<a href="http://it.diveintopython.net/object_oriented_framework/importing_modules.html" title="Avanti: “Importare i moduli usando from module import”">&gt;&gt;</a></td>
</tr>
<tr>
<td colspan="3" id="logocontainer">
<h1 id="logo"><a href="http://it.diveintopython.net/index.html" accesskey="1">Dive Into Python</a></h1>
<p id="tagline">Python per programmatori esperti</p>
</td>
<td colspan="3" align="right">
<form id="search" method="GET" action="http://www.google.com/custom">
<p><label for="q" accesskey="4">Find:&nbsp;</label><input type="text" id="q" name="q" size="20" maxlength="255" value=" " /> <input type="submit" value="Search" /><input type="hidden" name="cof" value="LW:752;L:http://diveintopython.org/images/diveintopython.png;LH:42;AH:left;GL:0;AWFID:3ced2bb1f7f1b212;" /><input type="hidden" name="domains" value="diveintopython.org" /><input type="hidden" name="sitesearch" value="diveintopython.org" /></p>
</form>
</td>
</tr>
</table>
<div class="chapter" lang="it">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="fileinfo"></a>Capitolo&nbsp;4.&nbsp;Una struttura orientata agli oggetti
                  </h2>
</div>
</div>
<div></div>
</div>
<div class="toc">
<ul>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/index.html#fileinfo.divein">4.1. Immergersi</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/importing_modules.html">4.2. Importare i moduli usando from module import</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/defining_classes.html">4.3. Definire classi</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/instantiating_classes.html">4.4. Istanziare classi</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/userdict.html">4.5. UserDict: una classe wrapper</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/special_class_methods.html">4.6. Metodi speciali per le classi</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/special_class_methods2.html">4.7. Metodi speciali di classe avanzati</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/class_attributes.html">4.8. Attributi di classe</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/private_functions.html">4.9. Funzioni private</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/handling_exceptions.html">4.10. Gestire le eccezioni</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/file_objects.html">4.11. Oggetti file</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/for_loops.html">4.12. Cicli for </a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/more_on_modules.html">4.13. Ancora sui moduli</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/os_module.html">4.14. Il modulo os</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/all_together.html">4.15. Mettere tutto insieme</a></span></li>
<li><span class="section"><a href="http://it.diveintopython.net/object_oriented_framework/summary.html">4.16. Sommario</a></span></li>
</ul>
</div>
<div class="section" lang="it">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="fileinfo.divein"></a>4.1.&nbsp;Immergersi
                     </h2>
</div>
</div>
<div></div>
</div>
<p>
               	Questo capitolo, e saltuariamente anche i capitoli successivi,
               	si occuperanno della programmazione ad oggetti in <span class="application">Python</span>.
               
               
               
            </p>
<div class="abstract">
<p>
                  	Eccovi un completo e funzionante programma in <span class="application">Python</span>.
                  	Leggete la
                  	<a href="http://it.diveintopython.net/getting_to_know_python/documenting_functions.html" title="2.3.&nbsp;Documentare le funzioni"><tt class="literal">docstring</tt></a>
                  	del modulo, le classi e le funzioni, in modo da avere un'idea
                  	di cosa faccia e come lavori questo programma. Come al solito,
                  	non curatevi delle parti che non comprendete; il resto del
                  	capitolo &egrave; fatto per loro.
                  
               </p>
</div>
<div class="example"><a name="d0e8069"></a><h3 class="title">Esempio&nbsp;4.1.&nbsp;<tt class="filename">fileinfo.py</tt></h3>
<p>Se non lo avete ancora fatto, potete
                  <a href="http://it.diveintopython.net/download/diveintopython-examples-2.0.zip" title="Download example scripts">
                     scaricare</a> questo ed altri esempi usati in questo libro.
               </p><pre class="programlisting">
<span class="pystring">"""Framework for getting filetype-specific metadata.

Instantiate appropriate class with filename.  Returned object acts like a
dictionary, with key-value pairs for each piece of metadata.
    import fileinfo
    info = fileinfo.MP3FileInfo("/music/ap/mahadeva.mp3")
    print "\\n".join(["%s=%s" % (k, v) for k, v in info.items()])

Or use listDirectory function to get info on all files in a directory.
    for info in fileinfo.listDirectory("/music/ap/", [".mp3"]):
        ...

Framework can be extended by adding classes for particular file types, e.g.
HTMLFileInfo, MPGFileInfo, DOCFileInfo.  Each class is completely responsible for
parsing its files appropriately; see MP3FileInfo for example.
"""</span>
<span class="pykeyword">import</span> os
<span class="pykeyword">import</span> sys
<span class="pykeyword">from</span> UserDict <span class="pykeyword">import</span> UserDict

<span class="pykeyword">def</span><span class="pyclass"> stripnulls</span>(data):
    <span class="pystring">"strip whitespace and nulls"</span>
    <span class="pykeyword">return</span> data.replace(<span class="pystring">"\00"</span>, <span class="pystring">""</span>).strip()

<span class="pykeyword">class</span><span class="pyclass"> FileInfo</span>(UserDict):
    <span class="pystring">"store file metadata"</span>
    <span class="pykeyword">def</span><span class="pyclass"> __init__</span>(self, filename=None):
        UserDict.__init__(self)
        self[<span class="pystring">"name"</span>] = filename

<span class="pykeyword">class</span><span class="pyclass"> MP3FileInfo</span>(FileInfo):
    <span class="pystring">"store ID3v1.0 MP3 tags"</span>
    tagDataMap = {<span class="pystring">"title"</span>   : (  3,  33, stripnulls),
                  <span class="pystring">"artist"</span>  : ( 33,  63, stripnulls),
                  <span class="pystring">"album"</span>   : ( 63,  93, stripnulls),
                  <span class="pystring">"year"</span>    : ( 93,  97, stripnulls),
                  <span class="pystring">"comment"</span> : ( 97, 126, stripnulls),
                  <span class="pystring">"genre"</span>   : (127, 128, ord)}

    <span class="pykeyword">def</span><span class="pyclass"> __parse</span>(self, filename):
        <span class="pystring">"parse ID3v1.0 tags from MP3 file"</span>
        self.clear()
        <span class="pykeyword">try</span>:                               
            fsock = open(filename, <span class="pystring">"rb"</span>, 0)
            <span class="pykeyword">try</span>:                           
                fsock.seek(-128, 2)        
                tagdata = fsock.read(128)  
            <span class="pykeyword">finally</span>:                       
                fsock.close()              
            <span class="pykeyword">if</span> tagdata[:3] == <span class="pystring">"TAG"</span>:
                <span class="pykeyword">for</span> tag, (start, end, parseFunc) <span class="pykeyword">in</span> self.tagDataMap.items():
                    self[tag] = parseFunc(tagdata[start:end])               
        <span class="pykeyword">except</span> IOError:                    
            <span class="pykeyword">pass</span>                           

    <span class="pykeyword">def</span><span class="pyclass"> __setitem__</span>(self, key, item):
        <span class="pykeyword">if</span> key == <span class="pystring">"name"</span> <span class="pykeyword">and</span> item:
            self.__parse(item)
        FileInfo.__setitem__(self, key, item)

<span class="pykeyword">def</span><span class="pyclass"> listDirectory</span>(directory, fileExtList):                                        
    <span class="pystring">"get list of file info objects for files of particular extensions"</span>
    fileList = [os.path.normcase(f) <span class="pykeyword">for</span> f <span class="pykeyword">in</span> os.listdir(directory)]               
    fileList = [os.path.join(directory, f) <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList \
                <span class="pykeyword">if</span> os.path.splitext(f)[1] <span class="pykeyword">in</span> fileExtList]                         
    <span class="pykeyword">def</span><span class="pyclass"> getFileInfoClass</span>(filename, module=sys.modules[FileInfo.__module__]):      
        <span class="pystring">"get file info class from filename extension"</span>                             
        subclass = <span class="pystring">"%sFileInfo"</span> % os.path.splitext(filename)[1].upper()[1:]       
        <span class="pykeyword">return</span> hasattr(module, subclass) <span class="pykeyword">and</span> getattr(module, subclass) <span class="pykeyword">or</span> FileInfo
    <span class="pykeyword">return</span> [getFileInfoClass(f)(f) <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList]                             

<span class="pykeyword">if</span> __name__ == <span class="pystring">"__main__"</span>:
    <span class="pykeyword">for</span> info <span class="pykeyword">in</span> listDirectory(<span class="pystring">"/music/_singles/"</span>, [<span class="pystring">".mp3"</span>]): <a name="fileinfo_divein.1.1"></a><img src="http://it.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
        <span class="pykeyword">print</span> <span class="pystring">"\n"</span>.join([<span class="pystring">"%s=%s"</span> % (k, v) <span class="pykeyword">for</span> k, v <span class="pykeyword">in</span> info.items()])
        print</pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td width="12" valign="top" align="left"><a href="http://it.diveintopython.net/object_oriented_framework/index.html#fileinfo_divein.1.1"><img src="http://it.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a>
</td>
<td valign="top" align="left">
                           	L'output di questo programma dipende dai file presenti sul
                           	vostro disco. Per ottenere un output sensato dovrete
                           	modificare il percorso della directory per puntarne una
                           	sulla vostra macchina in cui siano presenti dei
                           	file MP3.
                           
                        </td>
</tr>
</table>
</div>
</div>
<div class="example"><a name="d0e8086"></a><h3 class="title">Esempio&nbsp;4.2.&nbsp;Output di <tt class="filename">fileinfo.py</tt></h3>
<p>
                  	Questo &egrave; l'output che ho ottenuto sulla mia macchina. Il
                  	vostro output sar&agrave; differente, a meno che, per una qualche
                  	allarmante coincidenza, abbiate i miei stessi gusti in
                  	fatto di musica.
                  
               </p><pre class="screen"><span class="computeroutput">album=
artist=Ghost in the Machine
title=A Time Long Forgotten (Concept
genre=31
name=/music/_singles/a_time_long_forgotten_con.mp3
year=1999
comment=http://mp3.com/ghostmachine

album=Rave Mix
artist=***DJ MARY-JANE***
title=HELLRAISER****Trance from Hell
genre=31
name=/music/_singles/hellraiser.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Rave Mix
artist=***DJ MARY-JANE***
title=KAIRO****THE BEST GOA
genre=31
name=/music/_singles/kairo.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Journeys
artist=Masters of Balance
title=Long Way Home
genre=31
name=/music/_singles/long_way_home1.mp3
year=2000
comment=http://mp3.com/MastersofBalan

album=
artist=The Cynic Project
title=Sidewinder
genre=18
name=/music/_singles/sidewinder.mp3
year=2000
comment=http://mp3.com/cynicproject

album=Digitosis@128k
artist=VXpanded
title=Spinning
genre=255
name=/music/_singles/spinning.mp3
year=2000
comment=http://mp3.com/artists/95/vxp</span></pre></div>
</div>
</div>
<table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0" summary="">
<tr>
<td width="35%" align="left"><br /><a class="NavigationArrow" href="http://it.diveintopython.net/power_of_introspection/summary.html">&lt;&lt;&nbsp;Sommario</a></td>
<td width="30%" align="center"><br />&nbsp;<span class="divider">|</span>&nbsp;<span class="thispage">1</span> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/importing_modules.html" title="4.2.&nbsp;Importare i moduli usando from module import">2</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/defining_classes.html" title="4.3.&nbsp;Definire classi">3</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/instantiating_classes.html" title="4.4.&nbsp;Istanziare classi">4</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/userdict.html" title="4.5.&nbsp;UserDict: una classe wrapper">5</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/special_class_methods.html" title="4.6.&nbsp;Metodi speciali per le classi">6</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/special_class_methods2.html" title="4.7.&nbsp;Metodi speciali di classe avanzati">7</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/class_attributes.html" title="4.8.&nbsp;Attributi di classe">8</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/private_functions.html" title="4.9.&nbsp;Funzioni private">9</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/handling_exceptions.html" title="4.10.&nbsp;Gestire le eccezioni">10</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/file_objects.html" title="4.11.&nbsp;Oggetti file">11</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/for_loops.html" title="4.12.&nbsp;Cicli for ">12</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/more_on_modules.html" title="4.13.&nbsp;Ancora sui moduli">13</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/os_module.html" title="4.14.&nbsp;Il modulo os">14</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/all_together.html" title="4.15.&nbsp;Mettere tutto insieme">15</a> <span class="divider">|</span> <a href="http://it.diveintopython.net/object_oriented_framework/summary.html" title="4.16.&nbsp;Sommario">16</a>&nbsp;<span class="divider">|</span>&nbsp;
            </td>
<td width="35%" align="right"><br /><a class="NavigationArrow" href="http://it.diveintopython.net/object_oriented_framework/importing_modules.html">Importare i moduli usando from module import&nbsp;&gt;&gt;</a></td>
</tr>
<tr>
<td colspan="3"><br /></td>
</tr>
</table>
<div class="Footer">
<p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003 <a href="mailto:josh@servercobra.com">Mark Pilgrim</a></p>
<p class="copyright">Copyright &copy; 2003 Si veda l'appendice <span class="emphasis"><em>E: "Storia delle revisioni"</em></span></p>
</div>
</body>
</html>
