
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>3.7. Advanced special class methods</title><link rel="stylesheet" href="/css/diveintopython.css" type="text/css" /><link rev="made" href="josh@servercobra.com" /><meta name="generator" content="DocBook XSL Stylesheets V" /><meta name="keywords" content="Python, язык Python, язык программирования Python, Dive Into Python, В глубь языка Python, учебник, объектно-ориентированный, программирование, документация, книга, free, свободный, бесплатный" /><meta name="description" content="a free Python book for experienced programmers" /><link rel="home" href="http://ru.diveintopython.net/" title="В глубь языка Python" /><link rel="up" href="http://ru.diveintopython.net/" title="Глава 3. Средства объектно-ориентированного программирования" /><link rel="previous" href="http://ru.diveintopython.net/" title="3.6. Special class methods" /><link rel="next" href="http://ru.diveintopython.net/" title="3.8. Class attributes" /><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body>
<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<table id="Header" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td id="breadcrumb" colspan="5" align="left"><a href="http://ru.diveintopython.net/index.html">&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/toc.html">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html">&#1057;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;</a>&nbsp;&gt;&nbsp;<b>Advanced special class methods</b></td><td id="navigation" align="right">&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_specialmethods.html" title="Пред.: “Special class methods”">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_classattributes.html" title="След.: “Class attributes”">&gt;&gt;</a></td></tr><tr><td><img src="http://ru.diveintopython.net/images/logo.png" alt="diveinto.python.ru" /></td><td colspan="2"><span id="logo">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</span><br /><span id="tagline">&#1044;&#1083;&#1103; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1089;&#1090;&#1086;&#1074;</span></td><td colspan="3" align="right"></td></tr></table><div class="section"><a name="fileinfo.morespecial"></a><div class="titlepage"><div><h2 class="title"><a name="fileinfo.morespecial"></a>3.7. Advanced special class methods</h2></div></div><div class="abstract"><p>There are more special methods than just <tt>__getitem__</tt> and <tt>__setitem__</tt>.  Some of them let you emulate functionality that you may not even know about.</p></div><div class="example"><p><a name="d0e3800"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.17. More special methods in <tt>UserDict</tt></b></p><pre class="programlisting">
    <span class="pykeyword">def</span><span class="pyclass"> __repr__</span>(self): <span class="pykeyword">return</span> repr(self.data)     <a name="fileinfo.morespecial.1.1"></a><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
    <span class="pykeyword">def</span><span class="pyclass"> __cmp__</span>(self, dict):                       <a name="fileinfo.morespecial.1.2"></a><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" />
        <span class="pykeyword">if</span> isinstance(dict, UserDict):            
            <span class="pykeyword">return</span> cmp(self.data, dict.data)      
        <span class="pykeyword">else</span>:                                     
            <span class="pykeyword">return</span> cmp(self.data, dict)           
    <span class="pykeyword">def</span><span class="pyclass"> __len__</span>(self): <span class="pykeyword">return</span> len(self.data)       <a name="fileinfo.morespecial.1.3"></a><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" />
    <span class="pykeyword">def</span><span class="pyclass"> __delitem__</span>(self, key): <span class="pykeyword">del</span> self.data[key] <a name="fileinfo.morespecial.1.4"></a><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></pre><div class="calloutlist"><a name="d0e3808"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_morespecial.html#fileinfo.morespecial.1.1"><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>__repr__</tt> is a special method which is called when you call <tt>repr(<i>instance</i>)</tt>.  The <tt>repr</tt> function is a built-in function that returns a string representation of an object.  It works on any object, not just class instances.  You're already intimately familiar with <tt>repr</tt> and you don't even know it.  In the interactive window, when you type just a variable name and hit <b>ENTER</b>, Python uses <tt>repr</tt> to display the variable's value.  Go create a dictionary <tt>d</tt> with some data and then <tt>print repr(d)</tt> to see for yourself.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_morespecial.html#fileinfo.morespecial.1.2"><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>__cmp__</tt> is called when you compare class instances.  In general, you can compare any two Python objects, not just class instances, by using <tt>==</tt>.  There are rules that define when built-in datatypes are considered equal; for instance, dictionaries are equal when they have all the same keys and values, and strings are equal when they are the same length and contain the same sequence of characters.  For class instances, you can define the <tt>__cmp__</tt> method and code the comparison logic yourself, and then you can use <tt>==</tt> to compare instances of your class and Python will call your <tt>__cmp__</tt> special method for you.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_morespecial.html#fileinfo.morespecial.1.3"><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>__len__</tt> is called when you call <tt>len(<i>instance</i>)</tt>.  The <tt>len</tt> function is a built-in function that returns the length of an object.  It works on any object that could reasonably be thought of as having a length.  The <tt>len</tt> of a string is its number of characters; the <tt>len</tt> of a dictionary is its number of keys; the <tt>len</tt> of a list or tuple is its number of elements.  For class instances, define the <tt>__len__</tt> method and code the length calculation yourself, then call <tt>len(<i>instance</i>)</tt> and Python will call your <tt>__len__</tt> special method for you.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_morespecial.html#fileinfo.morespecial.1.4"><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>__delitem__</tt> is called when you call <tt>del <i>instance</i>[<i>key</i>]</tt>, which you may remember as the way to <a href="http://ru.diveintopython.net/odbchelper_dict.html#odbchelper.dict.del" title="Пример 1.12. Удаление записей из словарей">delete individual items from a dictionary</a>.  When you use <tt>del</tt> on a class instance, Python calls the <tt>__delitem__</tt> special method for you.</td></tr></table></div></div><a name="compare.strequals.java"></a><table class="note" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/note.png" alt="Замечание" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">In Java, you determine whether two string variables reference the same physical memory location by using <tt>str1 == str2</tt>.  This is called <span class="emphasis"><i>object identity</i></span>, and it is written in Python as <tt>str1 is str2</tt>.  To compare string values in Java, you would use <tt>str1.equals(str2)</tt>; in Python, you would use <tt>str1 == str2</tt>.  Java programmers who have been taught to believe that the world is a better place because <tt>==</tt> in Java compares by identity instead of by value may have a difficult time adjusting to Python's lack of such &#8220;gotchas&#8221;.</td></tr></table><p>At this point, you may be thinking, &#8220;all this work just to do something in a class that I can do with a built-in datatype&#8221;.  And it's true that life would be easier (and the entire <tt>UserDict</tt> class would be unnecessary) if you could inherit from built-in datatypes like a dictionary.  But even if you could, special methods would still be useful, because they can be used in any class, not just wrapper classes like <tt>UserDict</tt>.</p><p>Special methods mean that <span class="emphasis"><i>any class</i></span> can store key-value pairs like a dictionary, just by defining the <tt>__setitem__</tt> method.  <span class="emphasis"><i>Any class</i></span> can act like a sequence, just by defining the <tt>__getitem__</tt> method.  Any class that defines the <tt>__cmp__</tt> method can be compared with <tt>==</tt>.  And if your class represents something that has a length, don't define a <tt>GetLength</tt> method; define the <tt>__len__</tt> method and use <tt>len(<i>instance</i>)</tt>.</p><a name="note.physical.v.logical"></a><table class="note" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/note.png" alt="Замечание" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">While other object-oriented languages only let you define the physical model of an object (&#8220;this object has a <tt>GetLength</tt> method&#8221;), Python's special class methods like <tt>__len__</tt> allow you to define the logical model of an object (&#8220;this object has a length&#8221;).</td></tr></table><p>There are lots of other special methods.  There's a whole set of them that let classes act like numbers, allowing you to add, subtract, and do other arithmetic operations on class instances.  (The canonical example of this is a class that represents complex numbers, numbers with both real and imaginary components.)  The <tt>__call__</tt> method lets a class act like a function, allowing you to call a class instance directly.  And there are other special methods that allow classes to have read-only and write-only data attributes; we'll talk more about those in later chapters.</p><div class="furtherreading"><p><b>Further reading</b></p><ul><li><a href="http://ru.diveintopython.net/doc/current/ref/"><i>Python Reference Manual</i></a> documents <a href="http://ru.diveintopython.net/doc/current/ref/specialnames.html">all the special class methods</a>.</li></ul></div></div><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td width="35%" align="left"><br /><a href="http://ru.diveintopython.net/fileinfo_specialmethods.html"><span class="NavigationArrow">&lt;&lt;</span>&nbsp;Special class methods</a></td><td width="30%" align="center"><br />&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html#fileinfo.divein" title="3.1. В глубь">1</a> <a href="http://ru.diveintopython.net/fileinfo_fromimport.html" title="3.2. Импортирование модулей инструкцией from module import">2</a> <a href="http://ru.diveintopython.net/fileinfo_class.html" title="3.3. Определение классов">3</a> <a href="http://ru.diveintopython.net/fileinfo_instantiation.html" title="3.4. Создание экземпляров классов">4</a> <a href="http://ru.diveintopython.net/fileinfo_userdict.html" title="3.5. UserDict: a wrapper class">5</a> <a href="http://ru.diveintopython.net/fileinfo_specialmethods.html" title="3.6. Special class methods">6</a> <b>7</b> <a href="http://ru.diveintopython.net/fileinfo_classattributes.html" title="3.8. Class attributes">8</a> <a href="http://ru.diveintopython.net/fileinfo_private.html" title="3.9. Private functions">9</a> <a href="http://ru.diveintopython.net/fileinfo_exception.html" title="3.10. Handling exceptions">10</a> <a href="http://ru.diveintopython.net/fileinfo_files.html" title="3.11. File objects">11</a> <a href="http://ru.diveintopython.net/fileinfo_for.html" title="3.12. for loops">12</a> <a href="http://ru.diveintopython.net/fileinfo_modules.html" title="3.13. More on modules">13</a> <a href="http://ru.diveintopython.net/fileinfo_os.html" title="3.14. The os module">14</a> <a href="http://ru.diveintopython.net/fileinfo_alltogether.html" title="3.15. Putting it all together">15</a> <a href="http://ru.diveintopython.net/fileinfo_summary.html" title="3.16. Summary">16</a>&nbsp;</td><td width="35%" align="right"><br /><a href="http://ru.diveintopython.net/fileinfo_classattributes.html">Class attributes&nbsp;<span class="NavigationArrow">&gt;&gt;</span></a></td></tr><tr><td colspan="3"><br /></td></tr></table><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td align="left"><p class="copyright">Copyright &copy; 2000, 2001, 2002 <a href="mailto:josh@servercobra.com">&#1052;&#1072;&#1088;&#1082; &#1055;&#1080;&#1083;&#1075;&#1088;&#1080;&#1084;</a></p><p class="copyright">Copyright &copy; 2001, 2002, 2003 &#1055;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;, <a href="mailto:josh@servercobra.com">&#1044;&#1077;&#1085;&#1080;&#1089; &#1054;&#1090;&#1082;&#1080;&#1076;&#1072;&#1095;</a></p></td><td align="left">&nbsp;</td></tr></table></body></html>
