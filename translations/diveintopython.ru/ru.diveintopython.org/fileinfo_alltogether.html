
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.15. Putting it all together</title><link rel="stylesheet" href="http://web.archive.org/web/20110709015417cs_/http://ru.diveintopython.org/diveintopython.css" type="text/css"><link rev="made" href="mailto:f8dy@diveintopython.org"><meta name="generator" content="DocBook XSL Stylesheets V"><meta name="keywords" content="Python, &#1103;&#1079;&#1099;&#1082; Python, &#1103;&#1079;&#1099;&#1082; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103; Python, Dive Into Python, &#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python, &#1091;&#1095;&#1077;&#1073;&#1085;&#1080;&#1082;, &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081;, &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;, &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1094;&#1080;&#1103;, &#1082;&#1085;&#1080;&#1075;&#1072;, free, &#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1085;&#1099;&#1081;, &#1073;&#1077;&#1089;&#1087;&#1083;&#1072;&#1090;&#1085;&#1099;&#1081;"><meta name="description" content="a free Python book for experienced programmers"><link rel="home" href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/toc.html" title="&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python"><link rel="up" href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_divein.html" title="&#1043;&#1083;&#1072;&#1074;&#1072; 3. &#1057;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;"><link rel="previous" href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html" title="3.14. The os module"><link rel="next" href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_summary.html" title="3.16. Summary"></head><body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="http://staticweb.archive.org/js/disclaim-element.js" ></script>
<script type="text/javascript" src="http://staticweb.archive.org/js/graph-calc.js" ></script>
<script type="text/javascript" src="http://staticweb.archive.org/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1325375999999;
var wbPrefix = "http://web.archive.org/web/";
var wbCurrentUrl = "http:\/\/ru.diveintopython.org\/fileinfo_alltogether.html";

var curYear = -1;
var curMonth = -1;
var yearCount = 16;
var firstYear = 1996;
var imgWidth=400;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "9";
var displayMonth = "Jul";
var displayYear = "2011";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(http://staticweb.archive.org/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="http://wayback.archive.org/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="http://staticweb.archive.org/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="http://wayback.archive.org/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://ru.diveintopython.org/fileinfo_alltogether.html" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20110709015417" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="http://web.archive.org/web/20100929082826/http://ru.diveintopython.org/fileinfo_alltogether.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="29 Sep 2010"><strong>SEP</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 1:54:17 Jul 9, 2011">JUL</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Aug
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="http://web.archive.org/web/20100929082826/http://ru.diveintopython.org/fileinfo_alltogether.html" title="8:28:26 Sep 29, 2010" style="background-color:transparent;border:none;"><img src="http://staticweb.archive.org/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 1:54:17 Jul 9, 2011">9</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="http://staticweb.archive.org/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="http://web.archive.org/web/20100315181542/http://ru.diveintopython.org/fileinfo_alltogether.html" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="15 Mar 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 1:54:17 Jul 9, 2011">2011</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2012
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="http://wayback.archive.org/web/20110709015417*/http://ru.diveintopython.org/fileinfo_alltogether.html" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>22 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">26 May 03 - 9 Jul 11</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:400px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:400px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="400"
				height="27"
				border="0"
				src="http://wayback.archive.org/jsp/graph.jsp?graphdata=400_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000010000000_2004:-1:000000101010_2005:-1:100000000001_2006:-1:000000100100_2007:-1:110000020100_2008:-1:101010100000_2009:-1:101000000000_2010:-1:001000001000_2011:6:000000100000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="http://staticweb.archive.org/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="http://staticweb.archive.org/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(http://staticweb.archive.org/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(http://staticweb.archive.org/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->
<table id="Header" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td id="breadcrumb" colspan="5" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/index.html">&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</a>&nbsp;&gt;&nbsp;<a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/toc.html">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</a>&nbsp;&gt;&nbsp;<a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_divein.html">&#1057;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;</a>&nbsp;&gt;&nbsp;<b>Putting it all together</b></td><td id="navigation" align="right">&nbsp;&nbsp;&nbsp;<a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html" title="&#1055;&#1088;&#1077;&#1076;.: &#8220;The os module&#8221;">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;<a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_summary.html" title="&#1057;&#1083;&#1077;&#1076;.: &#8220;Summary&#8221;">&gt;&gt;</a></td></tr><tr><td><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/logo.png" alt="diveinto.python.ru"></td><td colspan="2"><span id="logo">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</span><br><span id="tagline">&#1044;&#1083;&#1103; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1089;&#1090;&#1086;&#1074;</span></td><td colspan="3" align="right"></td></tr></table><div class="section"><a name="fileinfo.alltogether"></a><div class="titlepage"><div><h2 class="title"><a name="fileinfo.alltogether"></a>3.15. Putting it all together</h2></div></div><div class="abstract"><p>Once again, all the dominoes are in place.  We've seen how each line of code works.  Now let's step back and see how it all fits together.</p></div><div class="example"><p><a name="fileinfo.nested"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.39. <tt>listDirectory</tt></b></p><pre class="programlisting"><span class='pykeyword'>
def</span> listDirectory(directory, fileExtList):                                         <a name="fileinfo.alltogether.1.1"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/1.png" alt="1" border="0" width="12" height="12">
    <span class='pystring'>"""&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1089; &#1084;&#1077;&#1090;&#1072;&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1077;&#1081; &#1076;&#1083;&#1103; &#1074;&#1089;&#1077;&#1093; &#1092;&#1072;&#1081;&#1083;&#1086;&#1074; &#1089;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1099;&#1084; &#1088;&#1072;&#1089;&#1096;&#1080;&#1088;&#1077;&#1085;&#1080;&#1077;&#1084;"""</span>                       
    fileList = [os.path.normcase(f) <span class='pykeyword'>for</span> f <span class='pykeyword'>in</span> os.listdir(directory)]               
    fileList = [os.path.join(directory, f) <span class='pykeyword'>for</span> f <span class='pykeyword'>in</span> fileList \
                <span class='pykeyword'>if</span> os.path.splitext(f)[1] <span class='pykeyword'>in</span> fileExtList]                          <a name="fileinfo.alltogether.1.2"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/2.png" alt="2" border="0" width="12" height="12">
    <span class='pykeyword'>def</span><span class='pyclass'> getFileInfoClass</span>(filename, module=sys.modules[FileInfo.__module__]):       <a name="fileinfo.alltogether.1.3"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/3.png" alt="3" border="0" width="12" height="12">
        <span class='pystring'>"&#1086;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090; &#1082;&#1083;&#1072;&#1089;&#1089;, &#1087;&#1088;&#1077;&#1076;&#1085;&#1072;&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1099;&#1081; &#1076;&#1083;&#1103; &#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1080; &#1092;&#1072;&#1081;&#1083;&#1072;, &#1087;&#1086; &#1088;&#1072;&#1089;&#1096;&#1080;&#1088;&#1077;&#1085;&#1080;&#1102;"</span>      
        subclass = <span class='pystring'>"%sFileInfo"</span> % os.path.splitext(filename)[1].upper()[1:]        <a name="fileinfo.alltogether.1.4"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/4.png" alt="4" border="0" width="12" height="12">
        <span class='pykeyword'>return</span> hasattr(module, subclass) <span class='pykeyword'>and</span> getattr(module, subclass) <span class='pykeyword'>or</span> FileInfo <a name="fileinfo.alltogether.1.5"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/5.png" alt="5" border="0" width="12" height="12">
    <span class='pykeyword'>return</span> [getFileInfoClass(f)(f) <span class='pykeyword'>for</span> f <span class='pykeyword'>in</span> fileList]                              <a name="fileinfo.alltogether.1.6"></a><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/6.png" alt="6" border="0" width="12" height="12"></pre><div class="calloutlist"><a name="d0e5062"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.1"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> </td><td valign="top" align="left"><tt>listDirectory</tt> is the main attraction of this entire module.  It takes a directory (like <tt>c:\music\_singles\</tt> in my case) and a list of interesting file extensions (like <tt>['.mp3']</tt>), and it returns a list of class instances that act like dictionaries that contain metadata about each interesting file in that directory.  And it does it in just a few straightforward lines of code.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.2"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> </td><td valign="top" align="left">As we saw in the <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html" title="3.14. The os module">previous section</a>, this line of code gets a list of the full pathnames of all the files in <tt>directory</tt> that have an interesting file extension (as specified by <tt>fileExtList</tt>).</td></tr><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.3"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> </td><td valign="top" align="left">Old-school Pascal programmers may be familiar with them, but most people give me a blank stare when I tell them that Python supports <span class="emphasis"><i>nested functions</i></span> -- literally, a function within a function.  The nested function <tt>getFileInfoClass</tt> can only be called from the function in which it is defined, <tt>listDirectory</tt>.  As with any other function, you don't need an interface declaration or anything fancy; just define the function and code it.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.4"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> </td><td valign="top" align="left">Now that you've seen the <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html" title="3.14. The os module"><tt>os</tt></a> module, this line should make more sense.  It gets the extension of the file (<tt>os.path.splitext(filename)[1]</tt>), forces it to uppercase (<tt>.upper()</tt>), slices off the dot (<tt>[1:]</tt>), and constructs a class name out of it with string formatting.  So <tt>c:\music\ap\mahadeva.mp3</tt> becomes <tt>.mp3</tt> becomes <tt>.MP3</tt> becomes <tt>MP3</tt> becomes <tt>MP3FileInfo</tt>.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.5"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> </td><td valign="top" align="left">Having constructed the name of the handler class that would handle this file, we check to see if that handler class actually exists in this module.  If it does, we return the class, otherwise we return the base class <tt>FileInfo</tt>.  This is a very important point: <span class="emphasis"><i>this function returns a class</i></span>.  Not an instance of a class, but the class itself.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_alltogether.html#fileinfo.alltogether.1.6"><img src="http://web.archive.org/web/20110709015417im_/http://ru.diveintopython.org/images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> </td><td valign="top" align="left">For each file in our &#8220;interesting files&#8221; list (<tt>fileList</tt>), we call <tt>getFileInfoClass</tt> with the filename (<tt>f</tt>).  Calling <tt>getFileInfoClass(f)</tt> returns a class; we don't know exactly which class, but we don't care.  We then create an instance of this class (whatever it is) and pass the filename (<tt>f</tt> again), to the <tt>__init__</tt> method.  As we saw <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_specialmethods.html#fileinfo.specialmethods.setname" title="&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.16. Setting an MP3FileInfo's name">earlier in this chapter</a>, the <tt>__init__</tt> method of <tt>FileInfo</tt> sets <tt>self["name"]</tt>, which triggers <tt>__setitem__</tt>, which is overridden in the descendant (<tt>MP3FileInfo</tt>) to parse the file appropriately to pull out the file's metadata.  We do all that for each interesting file and return a list of the resulting instances.</td></tr></table></div></div><p>Note that <tt>listDirectory</tt> is completely generic.  It doesn't know ahead of time which types of files it will be getting, or which classes are defined that could potentially handle those files.  It inspects the directory for the files to process, then introspects its own module to see what special handler classes (like <tt>MP3FileInfo</tt>) are defined.  You can extend this program to handle other types of files simply by defining an appropriately-named class: <tt>HTMLFileInfo</tt> for HTML files, <tt>DOCFileInfo</tt> for Word <tt>.doc</tt> files, and so forth.  <tt>listDirectory</tt> will handle them all, without modification, by handing the real work off to the appropriate classes and collating the results.</p></div><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td width="35%" align="left"><br><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html"><span class="NavigationArrow">&lt;&lt;</span>&nbsp;The os module</a></td><td width="30%" align="center"><br>&nbsp;<a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_divein.html#fileinfo.divein" title="3.1. &#1042; &#1075;&#1083;&#1091;&#1073;&#1100;">1</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_fromimport.html" title="3.2. &#1048;&#1084;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077; &#1084;&#1086;&#1076;&#1091;&#1083;&#1077;&#1081; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1077;&#1081; from module import">2</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_class.html" title="3.3. &#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077; &#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1074;">3</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_instantiation.html" title="3.4. &#1057;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077; &#1101;&#1082;&#1079;&#1077;&#1084;&#1087;&#1083;&#1103;&#1088;&#1086;&#1074; &#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1074;">4</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_userdict.html" title="3.5. UserDict: a wrapper class">5</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_specialmethods.html" title="3.6. Special class methods">6</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_morespecial.html" title="3.7. Advanced special class methods">7</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_classattributes.html" title="3.8. Class attributes">8</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_private.html" title="3.9. Private functions">9</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_exception.html" title="3.10. Handling exceptions">10</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_files.html" title="3.11. File objects">11</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_for.html" title="3.12. for loops">12</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_modules.html" title="3.13. More on modules">13</a> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_os.html" title="3.14. The os module">14</a> <b>15</b> <a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_summary.html" title="3.16. Summary">16</a>&nbsp;</td><td width="35%" align="right"><br><a href="http://web.archive.org/web/20110709015417/http://ru.diveintopython.org/fileinfo_summary.html">Summary&nbsp;<span class="NavigationArrow">&gt;&gt;</span></a></td></tr><tr><td colspan="3"><br></td></tr></table><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td align="left"><p class="copyright">Copyright &copy; 2000, 2001, 2002 <a href="mailto:f8dy@diveintopython.org">&#1052;&#1072;&#1088;&#1082; &#1055;&#1080;&#1083;&#1075;&#1088;&#1080;&#1084;</a></p><p class="copyright">Copyright &copy; 2001, 2002, 2003 &#1055;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;, <a href="mailto:ods@strana.ru">&#1044;&#1077;&#1085;&#1080;&#1089; &#1054;&#1090;&#1082;&#1080;&#1076;&#1072;&#1095;</a></p></td><td align="left">&nbsp;</td></tr></table></body></html>





<!--
     FILE ARCHIVED ON 1:54:17 Jul 9, 2011 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 19:32:44 Nov 4, 2011.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
